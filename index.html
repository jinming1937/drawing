<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HelloJM!</title>
  <link rel="stylesheet" href="./css/base.css">
  <!-- 初始化 -->
  <script src="./dom/init-canvas.js"></script>
  <!-- 悬浮坐标信息 -->
  <script src="./dom/axis-tips.js"></script>
  <!-- 设置背景 -->
  <script src="./draw/bg.js"></script>
  <!-- 画坐标 -->
  <script src="./draw/axis.js"></script>
  <!-- 鼠标画线 -->
  <script src="./dom/mouse-draw-line.js"></script>
  <!-- request animate frame -->
  <script src="./util/animate.js"></script>
  <!-- 计算矩阵 -->
  <script src="./lib/calculate.js"></script>
  <!-- 计算矩阵坐标 -->
  <script src="./lib/calc-matrix.js"></script>
  <!-- 转化坐标 -->
  <script src="./lib/translate-axis.js"></script>
  <!-- 画文本 -->
  <script src="./draw/text.js"></script>
</head>
<body>
  <div class="box">
    <canvas id="brick-app">您的浏览器居然不支持canvas元素!!!</canvas>
  </div>
  <script>
    window.onload = function () {
      console.log('window load ok, start js!!!');
      const printerSize = [680, 480];
      const [context, canvas] = window.initCanvas('brick-app', printerSize[0], printerSize[1]);
      // add dom
      window.axisTips(canvas);
      window.setBackground(context, '#000000'); // bg
      window.drawAxis(context);
      // const draws = window.draw(context);
      const startLeft = [-300 , -100];
      const matrixLeft = [112,2,3,4,512,6,7,8,-909];
      const startRight = [60 , -100];
      const matrixRight = [100,200,300,400,500,600,700,800,900];
      const startReturn = [-600, 100];
      const [result, resultStr] = calculate3(matrixLeft, matrixRight);

      const [leftMatrix] = window.drawMatrix(startLeft, matrixLeft, context);
      const [rightMatrix] = window.drawMatrix(startRight, matrixRight, context);
      const [resultMatrix] = window.drawMatrix(startReturn, resultStr, context);
      const allMatrix = [leftMatrix, rightMatrix, resultMatrix];

      const item = leftMatrix[0];
      window.animateFrame(function() {
        if (item.x >= -100 || item.y >= 100) {
          return;
        }
        item.x += 2.7;
        item.y += 2;
      });

      window.animateFrame(function (e) {
        context.clearRect(0, 0, canvas.width, canvas.height);
        window.setBackground(context, '#000000');
        window.drawAxis(context);
        // draw 
        allMatrix.forEach((arr) => {
          arr.forEach((item) => {
            window.drawText(context, '#FFFFFF', item.text, [item.x, item.y]);
          });
        });
        window.drawText(context, '#f44336', item.text, [item.x, item.y]);
      });
    }

    // 获取斜率
    function activePath(start, end) {
      const [startX, starY] = start;
      const [endX, endY] = end;
      if (endY === startY && endX === startX) return [0, 0, 0];
      if (endX === startX) return [0, 0, endY - startY];
      if (endY === startY) return [0, endX - startX, 0];
      return [(endY - startY) / (endX - startX), 0, 0];
    }
  </script>
</body>
</html>