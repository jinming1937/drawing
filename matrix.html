<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix!</title>
  <link rel="stylesheet" href="./css/base.css">
  <!-- 初始化 -->
  <script src="./dom/init-canvas.js"></script>
  <!-- 悬浮坐标信息 -->
  <script src="./dom/axis-tips.js"></script>
  <!-- 设置背景 -->
  <script src="./draw/bg.js"></script>
  <!-- 画坐标 -->
  <script src="./draw/axis.js"></script>
  <!-- 导出 -->
  <script src="./dom/export-picture.js"></script>
  <!-- request animate frame -->
  <script src="./util/animate.js"></script>
  <!-- 计算矩阵x乘 -->
  <script src="./lib/calculate.js"></script>
  <!-- 计算矩阵x乘 -->
  <script src="./lib/cal.js"></script>
  <!-- 计算矩阵坐标 -->
  <script src="./lib/cal-matrix.js"></script>
  <!-- 计算矩阵坐标 -->
  <script src="./lib/calculate-matrix.js"></script>
  <!-- 转化坐标 -->
  <script src="./lib/translate-axis.js"></script>
  <!-- 求斜率 -->
  <script src="./lib/active-path.js"></script>
  <!-- 画文本 -->
  <script src="./draw/text.js"></script>
</head>
<body>
  <div class="box">
    <canvas id="brick-app">您的浏览器居然不支持canvas元素!!!</canvas>
  </div>
  <div class="tool">
    <input type="button" id="export-picture" class="btn" value="export picture">
    <input class="color" type="color" value="#ffffff" name="color" id="color">
  </div>
  <script>

    function getNumMatrix(ctx) {
      const {calculateMatrix, calculate3} = window;
      const startLeft = [-300 , -100];
      const matrixLeft = [-3,2,3,-4,4,-2,7,8,-4];
      const startRight = [60 , -100];
      const matrixRight = [5,8,-1,2,-6,0,9,8,4];
      const startReturn = [-600, 100];
      const [result, resultStr] = calculate3(matrixLeft, matrixRight);
      const [leftMatrix] = calculateMatrix(startLeft, matrixLeft, ctx);
      const [rightMatrix] = calculateMatrix(startRight, matrixRight, ctx);
      const [resultMatrix] = calculateMatrix(startReturn, resultStr, ctx);
      const startR = [-200, 300];
      const [resultM] = calculateMatrix(startR, result, ctx);

      return [leftMatrix, rightMatrix, resultMatrix, resultM];
    }

    function getStrMatrix(ctx) {
      const {cal, calMatrix} = window;
      const startLeft = [-300 , -100];
      const matrixLeft = [
        [-3,2,3],
        [-4,8,1],
        [9,5,6],
      ];
      const startRight = [60 , -100];
      const matrixRight = [
        ['x'],
        ['y'],
        ['z']
      ];
      const startReturn = [-280, 100];
      const [result, resultStr] = cal(matrixLeft, matrixRight, true);
      const [leftMatrix] = calMatrix(startLeft, matrixLeft, ctx);
      const [rightMatrix] = calMatrix(startRight, matrixRight, ctx);
      const [resultMatrix] = calMatrix(startReturn, resultStr, ctx);
      return [leftMatrix, rightMatrix, resultMatrix];
    }

    window.onload = function () {
      const {
        // dom
        axisTips,
        initCanvas,
        initExportPicture,
        // draw
        drawAxis,
        setBackground,
        // global
        drawData,
        // lib
        // activePath,
        // translateAxis,
        // util
        animateFrame,
      } = window;
      console.log('window load ok, start js!!!');

      const [context, canvas] = initCanvas('brick-app', window.innerWidth, window.innerHeight);
      axisTips(canvas);
      setBackground(context, '#000000'); // bg
      initExportPicture(canvas); // 导出

      // const allMatrix = getNumMatrix(context);
      const allMatrix = getStrMatrix(context);

      // const item = leftMatrix[0];
      // animateFrame(function() {
      //   if (item.x >= -100 || item.y >= 100) {
      //     return;
      //   }
      //   item.x += 2.7;
      //   item.y += 2;
      // });

      animateFrame(function () {
        context.clearRect(0, 0, canvas.width, canvas.height);
        setBackground(context, '#000000');
        drawAxis(context);
        allMatrix.forEach((arr) => {
          arr.forEach((item) => {
            drawText(context, '#FFFFFF', item.text, [item.x, item.y]);
          });
        });
        // drawText(context, '#f44336', item.text, [item.x, item.y]);
      });
    }
  </script>
</body>
</html>